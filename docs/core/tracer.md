---
title: Tracer
description: Core utility
---

Tracer is an opinionated thin wrapper for [AWS X-Ray Python SDK](https://github.com/aws/aws-xray-sdk-node/).

![Tracer showcase](../media/tracer_utility_showcase.png)

## Key features

* Auto capture cold start as annotation, and responses or full exceptions as metadata
* Run functions locally with SAM CLI without code change to disable tracing
* Explicitly disable tracing via env var `POWERTOOLS_TRACE_ENABLED="false"`
* Support tracing async methods, generators, and context managers
* Auto patch supported modules by AWS X-Ray

## Getting started

### Permissions

Before your use this utility, your AWS Lambda function [must have permissions](https://docs.aws.amazon.com/lambda/latest/dg/services-xray.html#services-xray-permissions) to send traces to AWS X-Ray.

> Example using AWS Serverless Application Model (SAM)

=== "template.yml"
    ```yaml hl_lines="6 9"
    Resources:
      HelloWorldFunction:
        Type: AWS::Serverless::Function
        Properties:
          Runtime: nodejs14.x
          Tracing: Active
          Environment:
            Variables:
              POWERTOOLS_SERVICE_NAME: example
    ```

### Lambda handler

You can quickly start by importing the `Tracer` class, initialize it outside the Lambda handler, and use `capture_lambda_handler` decorator.

=== "app.py"
	```typescript hl_lines="1 3 6"
	import { Tracer } from '@aws-lambda-powertools/tracer';

	const tracer = Tracer(); // Sets service via env var
	// OR tracer = Tracer({ service: 'example' });

	@tracer.capture_lambda_handler
	const handler = (event, context) => {
		const chargeId = event.chargeId;
		const payment = collectPayment(chargeId);
		...
	}
	```

When using this `capture_lambda_handler` decorator, Tracer performs these additional tasks to ease operations:

* Creates a `ColdStart` annotation to easily filter traces that have had an initialization overhead
* Captures any response, or full exceptions generated by the handler, and include as tracing metadata

### Annotations & Metadata

**Annotations** are key-values associated with traces and indexed by AWS X-Ray. You can use them to filter traces and to create [Trace Groups](https://aws.amazon.com/about-aws/whats-new/2018/11/aws-xray-adds-the-ability-to-group-traces/) to slice and dice your transactions.

**Metadata** are key-values also associated with traces but not indexed by AWS X-Ray. You can use them to add additional context for an operation using any native object.

=== "Annotations"
	You can add annotations using `put_annotation` method.

    ```typescript hl_lines="7"
		import { Tracer } from '@aws-lambda-powertools/tracer';

    const tracer = Tracer()

    @tracer.capture_lambda_handler
    const handler = (event, context) => {
			...
			const res = some_logic();
			tracer.putAnnotation(key='payment_response', value=res);
		}
    ```
=== "Metadata"
	You can add metadata using `put_metadata` method.

    ```typescript hl_lines="9"
    import { Tracer } from '@aws-lambda-powertools/tracer';

    const tracer = Tracer()

    @tracer.capture_lambda_handler
    const handler = (event, context) => {
			...
			const res = some_logic();
			tracer.putMetadata(key='payment_response', value=res);
		}
    ```

:construction: WIP :construction:

## Testing your code

Powertools should be able to detect that it's not running inside a Lambda execution environment and disable tracing for you. If that doesn't work you can also disable it explicitly using `POWERTOOLS_TRACE_ENABLED` environment variable.

```bash
POWERTOOLS_TRACE_ENABLED=0 npm run test
```

## Tips

* Use annotations on key operations to slice and dice traces, create unique views, and create metrics from it via Trace Groups
* Use a namespace when adding metadata to group data more easily
* Annotations and metadata are added to the current subsegment opened. If you want them in a specific subsegment, use a [context manager](https://github.com/aws/aws-xray-sdk-python/#start-a-custom-segmentsubsegment) via the escape hatch mechanism
